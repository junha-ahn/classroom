<script type="text/x-template" id="input-template">
      <label>예약 상태</label>
      <select class="form-control" v-model="query.rsv_status" @change="changed()">
          <option v-bind:value="0" :selected="query.rsv_status==0">전체</option>
          <option v-for="(status, i) in rsv_status_results" v-bind:value="status.rsv_status" :selected="query.rsv_status == status.rsv_status" :key="i">
            {{ status.name }}
          </option>
        </select> 
        <label>학과</label>
        <select class="form-control" v-model="query.department_id" @change="changed()">
          <option v-bind:value="0" :selected="query.department_id===0">전체</option>
          <option v-for="(department, i) in department_results" v-bind:value="department.department_id" :selected="query.department_id == department.department_id" :key="i">
            {{ department.name }}
          </option>
        </select>
      
        <label>스터디</label>
        <select class="form-control" v-model="query.study_group_id" @change="changed()" :disabled="query.department_id===0">
          <option v-for="(study_group, j) in study_group_results" v-bind:value="study_group.study_group_id" :key="j">
            {{ study_group.name }}
          </option>
        </select>
            
        <table class="table table-hover">
          <thead>
            <th>교실</th>
            <th>카테고리</th>
            <th>상태</th>
            <th>시작</th>
            <th>종료</th>
            <th>학과(스터디)</th>
            <th>자세히보기</th>
          </thead>
          <tbody>
            <tr v-for="(room_rsv, i) in results" :key="i">
              <td>{{room_rsv.rooms_name}}</td>
              <td>{{room_rsv.room_rsv_category_name}}</td>
              <td>{{room_rsv.rsv_status_name}}</td>
              <td>{{room_rsv.start_datetime}}</td>
              <td>{{room_rsv.end_datetime}}</td>
              <td>{{makeDisplayName(room_rsv)}}</td>
              <td><button type="button" class="btn btn-default" @click="location.href='/resrervation/single/' + room_rsv.room_rsv_id">조회</button></td>
            </tr>
          </tbody>
        </table>
</script>

<script>
  Vue.component('custom-reservations', {
    template: '#input-template',
    props: ['query', 'params', 'rsv_status_results', 'department_results', 'study_group_results', 'results',
      'onChange'
    ],
    data: function () {
      return {
        query: this.query,
        params: this.params,
        rsv_status_results: this.rsv_status_results,
        department_results: this.department_results,
        study_group_results: this.study_group_results,
        results: this.results,
      }
    },
    methods: {
      makeDisplayName: function (room_rsv) {
        var name = ''
        if (room_rsv.department_name)
          name += room_rsv.department_name
        if (room_rsv.study_group_name)
          name += ' (' + room_rsv.study_group_name + ')'
        return name;
      },
      changed() {
        this.onChange(this.query.rsv_status, this.query.department_id, this.query.study_group_id);
      }
    },
  })
</script>