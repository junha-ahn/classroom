<% include ./sub/header %>
      <form v-on:submit="join">
        <label>학생</label>
        <input type="checkbox" v-model="joinForm.is_student" true-value="1" false-value="0">
        <br/>
        <label>학과</label>
        <select class="form-control" v-model="joinForm.department_id">
          <option v-for="(department, i) in department_results" v-bind:value="department.department_id" :key="i">
            {{ department.name }}
          </option>
        </select>
        <label>캠퍼스</label>
        <select class="form-control" v-model="joinForm.campus_id" @change="replaceBuildings()">
          <option v-for="(campus, i) in campus_results" v-bind:value="campus.campus_id" :key="i">
            {{ campus.name }}
          </option>
        </select>
        <label>학습관</label>
        <select class="form-control" v-model="joinForm.building_id">
          <option v-for="(building, j) in building_results" v-bind:value="building.building_id" :key="j">
            {{ building.name }}
          </option>
        </select>
        <div class="form-inline">
          <label>이메일 주소</label>
          <input v-model="joinForm.email" type="email" class="form-control" placeholder="이메일을 입력하세요">
          <button type="submit" class="btn btn-default">확인하기</button>
        </div>
        <div class="form-inline">
          <label>암호</label>
          <input v-model="joinForm.password" type="password" class="form-control" placeholder="암호">
        </div>
        <div class="form-inline">
          <label>암호 확인</label>
          <input type="password" class="form-control" placeholder="암호 확인">
        </div>
        <div class="form-inline">
          <label>이름</label>
          <input v-model="joinForm.name" type="text" class="form-control" placeholder="이름">
        </div>
        <div class="form-inline">
          <label>전화번호</label>
          <input v-model="joinForm.phone" type="text" class="form-control" placeholder="전화번호">
        </div>
        <div class="form-inline">
          <label>학번</label>
          <input v-model="joinForm.student_number" type="text" class="form-control" placeholder="학번">
        </div>
        <button type="submit" class="btn btn-primary">가입</button>
      </form>
    </main>
    
    <footer>
      <% include ./sub/footer %>
    </footer>
  </div>

  <script>
    var global = makeGlobal();
    var app = new Vue({
      el: '#app',
      data: function () {
        return {
          header_menu_name: global.getHeaderMenuName("<%-pagename %>"),
          is_user: <%- is_user %>,
          is_admin: <%- is_admin %>,
          department_results : <%-JSON.stringify(department_results) %>,
          campus_results : <%-JSON.stringify(campus_results) %>,
          buildings : <%-JSON.stringify(buildings) %>,
          building_results: [],
          joinForm: {
            is_student: 1,
            department_id: null,
            campus_id: null,
            building_id: null,
            campus_name: null,
            email: null,
            password: null,
            name: null,
            phone: null,
            student_number: null,
          }
        }
      },
      methods: {
        replaceBuildings: function (event) {
          this.building_results = this.buildings[this.joinForm.campus_id];
          this.joinForm.building_id = null;
        },
        join: function (e) {
          e.preventDefault();
          var __this = this;
          global.ajax({
              url: '/auth/join',
              type: 'POST',
              data: __this.joinForm
            },
            function (data, status) {
              alert(data.message);
              location.href='/'
            },
            function (message, status, data) {
              alert(message);
            });
        }
      }
    })
  </script>

</body>

</html>