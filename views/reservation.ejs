<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>

  <link rel='stylesheet' href='/stylesheets/style.css' />
  <script type="text/javascript" src="/javascripts/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
</head>

<body>

  <div id="app">
    <header>
      <% include ./header %>
    </header>

    <main>
      <template v-if="page_step=='intro'">
        <div class="panel panel-primary" @click="chageStep('room')">
          <div class="panel-heading">
            교실 예약
          </div>
          <div class="panel-body">
            원하는 교실을 예약합니다
          </div>
        </div>

        <div class="panel panel-primary" @click="chageStep('time')">
          <div class="panel-heading">
            시간 예약
          </div>
          <div class="panel-body">
            원하는 시간을 예약합니다
          </div>
        </div>
        
        <div class="panel panel-info">
          <div class="panel-heading">
            예약 조회
          </div>
          <div class="panel-body">
            예약을 예약합니다
          </div>
        </div>
      </template>
      <template v-else-if="page_step=='room'">
        <div class="btn-group btn-group-justified" role="group" aria-label="...">
          <div class="btn-group" role="group">
            <button type="button" :class="classObjectMenu(1)" :click="chageMenuStep(1)">1. 강의실 선택</button>
          </div>
          <div class="btn-group" role="group">
            <button type="button" :class="classObjectMenu(2)" :click="chageMenuStep(2)">2. 날짜 선택</button>
          </div>
          <div class="btn-group" role="group">
            <button type="button" :class="classObjectMenu(3)" :click="chageMenuStep(3)">3. 시간 선택</button>
          </div>
          <div class="btn-group" role="group">
            <button type="button" :class="classObjectMenu(4)" :click="chageMenuStep(4)">4. 상세 내용 입력</button>
          </div>
          <div class="btn-group" role="group">
            <button type="button" :class="classObjectMenu(5)" :click="chageMenuStep(5)">5. 예약 내용 확인</button>
          </div>
        </div>
        <div>
          <ol>
            <li v-for="(room, i) in rooms" :key="i">
              {{room.name}}
            </li>
          </ol>
        </div>
      </template>
      <template v-if="page_step=='time'">
      </template>
    </main>
    
    <footer>
      <% include ./footer %>
    </footer>
  </div>

  <script>
    var global = makeGlobal();
    var app = new Vue({
      el: '#app',
      data: function () {
        return {
          page_name: 'reservation',
          is_user: <%- is_user %>,
          is_admin: <%- is_admin %>,
          query : <%-JSON.stringify(query) %>,
          page_step : 'intro',
          page_type : null,
          section : {
            room : {
              menu_step : 1,

            },
            time : {
              menu_step : 1,

            },
          },
          rooms: [],
        }
      },
      methods: {
        chageMenuStep: function (menu_step) {
          if (this.page_step == 'room') {
            if (this.section[this.page_step].menu_step > menu_step) {
              this.section[this.page_step].menu_step = menu_step;
            }
          }
        },
        classObjectMenu: function (menu_step) {
          return {
            'btn btn-primary': this.section[this.page_step].menu_step == menu_step,
            'btn btn-default': this.section[this.page_step].menu_step != menu_step,
          }
        },
        chageStep: function(page_step) {
          this.page_step = page_step;
        },
        getRoom: function() {
          global.ajax({
            url: '/api/room',
            type: 'GET',
            data: null,
            query: {
              building_id : this.query.building_id,
            }
          },
          function(data, status) {
            app.rooms = data.results
          },
          function(message, status, data) {
            alert(message);
          })
        }
      },
      mounted() {
        
      },
      watch: {
        page_step: function(page_step) {
          if (page_step == 'room') {
            switch (this.section[this.page_step].menu_step) {
              case 1:
                this.getRoom();
                break;
              default:
                break;
            }
          } else {

          }
        },
      }
    })
  </script>

</body>

</html>