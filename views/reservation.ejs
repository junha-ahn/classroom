<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>

  <link rel='stylesheet' href='/stylesheets/style.css' />
  <script type="text/javascript" src="/javascripts/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
</head>

<body>

  <div id="app">
    <header>
      <% include ./sub/header %>
    </header>

    <main>
      <template v-if="page_step=='intro'">
        <% include ./reservation_intro %>
      </template>
      <template v-else-if="page_step=='room'">
        <% include ./reservation_room %>
      </template>
      <template v-if="page_step=='time'">
      </template>
    </main>
    
    <footer>
      <% include ./sub/footer %>
    </footer>
  </div>

  <script>
    var global = makeGlobal();
    var app = new Vue({
      el: '#app',
      data: function () {
        return {
          page_name: 'reservation',
          is_user: <%- is_user %>,
          is_admin: <%- is_admin %>,
          query : <%-JSON.stringify(query) %>,
          page_step : 'intro',
          page_type : null,
          section : {
            room : {
              menu_step : 1,
              floor:null,
              room_name: null,
            },
            time : {
              menu_step : 1,

            },
          },
          rooms: {},
          formData:{
            room_id:null,
          }
        }
      },
      methods: {
        chageMenuStep: function (menu_step) {
          if (this.page_step == 'room') {
            if (this.section[this.page_step].menu_step > menu_step) {
              this.section[this.page_step].menu_step = menu_step;
            }
          }
        },
        classObjectMenu: function (menu_step) {
          return {
            'btn btn-primary': this.section[this.page_step].menu_step == menu_step,
            'btn btn-default': this.section[this.page_step].menu_step != menu_step,
          }
        },
        chageStep: function(page_step) {
          this.page_step = page_step;
        },
        changeRoomFloor: function(floor) {
          this.section.room.floor = (this.section.room.floor == floor) ? null : floor;
        },
        chooseRoom: function(room) {
          this.section.room.room_name = room.room_number + room.name;
          this.formData.room_id = room.room_id;
        },
        getRoom: function() {
          global.ajax({
            url: '/api/room',
            type: 'GET',
            data: null,
            query: {
              building_id : this.query.building_id,
              sort_by_floor: 1,
            }
          },
          function(data, status) {
            app.rooms = data.results
          },
          function(message, status, data) {
            alert(message);
          })
        },
      },
      watch: {
        page_step: function(page_step) {
          if (page_step == 'room') {
            switch (this.section[this.page_step].menu_step) {
              case 1:
                this.getRoom();
                break;
              default:
                break;
            }
          } else {

          }
        },
      }
    })
  </script>

</body>

</html>